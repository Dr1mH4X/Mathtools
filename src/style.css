/* ===== Tailwind CSS v4 ===== */
@import "tailwindcss";

/* ===== Theme: map CSS custom properties to Tailwind ===== */
@theme {
    /* Colors */
    --color-bg: var(--c-bg);
    --color-bg-soft: var(--c-bg-soft);
    --color-bg-card: var(--c-bg-card);
    --color-bg-hover: var(--c-bg-hover);
    --color-bg-input: var(--c-bg-input);
    --color-border: var(--c-border);
    --color-border-light: var(--c-border-light);
    --color-text: var(--c-text);
    --color-text-soft: var(--c-text-soft);
    --color-text-muted: var(--c-text-muted);
    --color-primary: var(--c-primary);
    --color-primary-soft: var(--c-primary-soft);
    --color-primary-bg: var(--c-primary-bg);
    --color-primary-border: var(--c-primary-border);
    --color-accent: var(--c-accent);
    --color-success: var(--c-success);
    --color-warning: var(--c-warning);
    --color-danger: var(--c-danger);
    --color-danger-bg: var(--c-danger-bg);

    /* Shadows */
    --shadow-sm: var(--s-sm);
    --shadow-md: var(--s-md);
    --shadow-lg: var(--s-lg);
    --shadow-card: var(--s-card);

    /* Border radius */
    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 16px;
    --radius-xl: 24px;

    /* Fonts */
    --font-sans:
        "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Noto Sans SC", "PingFang SC", "Microsoft YaHei", sans-serif;
    --font-mono: "JetBrains Mono", "Fira Code", "SF Mono", Consolas, monospace;
}

/* ===== CSS Custom Properties (light / dark) ===== */
:root {
    --c-bg: #f5f7fa;
    --c-bg-soft: #ffffff;
    --c-bg-card: #ffffff;
    --c-bg-hover: #f0f2f5;
    --c-bg-input: #f8f9fb;
    --c-border: #e2e6ec;
    --c-border-light: #eef0f4;
    --c-text: #1a1a2e;
    --c-text-soft: #5a5f72;
    --c-text-muted: #9096a6;
    --c-primary: #4f6ef7;
    --c-primary-soft: #7b93fa;
    --c-primary-bg: rgba(79, 110, 247, 0.08);
    --c-primary-border: rgba(79, 110, 247, 0.25);
    --c-accent: #e74c8b;
    --c-success: #2ecc71;
    --c-warning: #f0a500;
    --c-danger: #e74c3c;
    --c-danger-bg: rgba(231, 76, 60, 0.08);

    --s-sm: 0 1px 3px rgba(0, 0, 0, 0.06);
    --s-md: 0 4px 12px rgba(0, 0, 0, 0.08);
    --s-lg: 0 8px 30px rgba(0, 0, 0, 0.1);
    --s-card: 0 2px 8px rgba(0, 0, 0, 0.06);

    --header-height: 60px;
    --sidebar-width: 260px;
    --transition: 0.2s ease;

    color-scheme: light;
}

[data-theme="dark"] {
    --c-bg: #0f1117;
    --c-bg-soft: #181a22;
    --c-bg-card: #1e2030;
    --c-bg-hover: #262838;
    --c-bg-input: #1a1c28;
    --c-border: #2d3044;
    --c-border-light: #242638;
    --c-text: #e4e6f0;
    --c-text-soft: #a0a4b8;
    --c-text-muted: #6c7086;
    --c-primary: #6b8aff;
    --c-primary-soft: #8da4ff;
    --c-primary-bg: rgba(107, 138, 255, 0.1);
    --c-primary-border: rgba(107, 138, 255, 0.3);
    --c-accent: #f472b6;
    --c-success: #34d399;
    --c-warning: #fbbf24;
    --c-danger: #f87171;
    --c-danger-bg: rgba(248, 113, 113, 0.1);

    --s-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
    --s-md: 0 4px 12px rgba(0, 0, 0, 0.3);
    --s-lg: 0 8px 30px rgba(0, 0, 0, 0.4);
    --s-card: 0 2px 8px rgba(0, 0, 0, 0.25);

    color-scheme: dark;
}

/* ===== Base / Reset ===== */
@layer base {
    *,
    *::before,
    *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html {
        font-size: 16px;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
    }

    body {
        font-family: var(--font-sans);
        background: var(--c-bg);
        color: var(--c-text);
        line-height: 1.6;
        min-height: 100vh;
        overflow-x: hidden;
        transition:
            background var(--transition),
            color var(--transition);
    }

    #app {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    a {
        color: var(--c-primary);
        text-decoration: none;
        transition: color var(--transition);
    }

    a:hover {
        color: var(--c-primary-soft);
    }

    img,
    svg {
        display: block;
        max-width: 100%;
    }

    label {
        display: block;
        font-size: 0.85rem;
        font-weight: 500;
        color: var(--c-text-soft);
        margin-bottom: 4px;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: transparent;
    }

    ::-webkit-scrollbar-thumb {
        background: var(--c-border);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--c-text-muted);
    }
}

/* ===== Reusable Components ===== */
@layer components {
    /* --- Buttons --- */
    .btn {
        @apply inline-flex items-center justify-center gap-2
               rounded-sm border border-border bg-bg-soft
               px-5 py-2.5 text-[0.9rem] font-medium leading-[1.4]
               text-text whitespace-nowrap select-none
               transition-all duration-200 ease-in-out cursor-pointer;
        font-family: var(--font-sans);
    }
    .btn:hover {
        @apply bg-bg-hover border-text-muted;
    }
    .btn:active {
        transform: translateY(1px);
    }
    .btn:disabled {
        @apply opacity-50 cursor-not-allowed;
        transform: none;
    }

    .btn-primary {
        @apply bg-primary text-white border-primary;
    }
    .btn-primary:hover {
        @apply bg-primary-soft border-primary-soft;
    }

    .btn-danger {
        @apply bg-danger-bg text-danger border-transparent;
    }
    .btn-danger:hover {
        @apply bg-danger text-white;
    }

    .btn-sm {
        @apply px-3 py-1.5 text-[0.8rem];
    }

    .btn-icon {
        @apply p-2 w-9 h-9;
    }

    /* --- Inputs --- */
    .input,
    input[type="text"],
    input[type="number"],
    select {
        @apply w-full rounded-sm border border-border
               bg-bg-input px-3.5 py-2.5 text-[0.9rem] leading-[1.4]
               text-text outline-none transition-all duration-200 ease-in-out;
        font-family: var(--font-sans);
    }
    .input:focus,
    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
        @apply border-primary;
        box-shadow: 0 0 0 3px var(--c-primary-bg);
    }
    .input::placeholder,
    input::placeholder {
        @apply text-text-muted;
    }

    select {
        @apply cursor-pointer pr-8;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%239096a6' d='M2.5 4.5L6 8l3.5-3.5'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
    }

    /* --- Cards --- */
    .card {
        @apply bg-bg-card border border-border rounded-md shadow-card
               transition-all duration-200 ease-in-out;
    }
    .card-header {
        @apply flex items-center gap-2.5 px-5 py-4
               border-b border-border-light font-semibold text-[0.95rem];
    }
    .card-body {
        @apply p-5;
    }

    /* --- Badges --- */
    .badge {
        @apply inline-flex items-center px-2.5 py-0.5
               text-xs font-semibold rounded-full tracking-wide;
    }
    .badge-primary {
        @apply bg-primary-bg text-primary;
    }
    .badge-success {
        color: var(--c-success);
        background: rgba(46, 204, 113, 0.12);
    }
    .badge-warning {
        color: var(--c-warning);
        background: rgba(240, 165, 0, 0.12);
    }

    /* --- Toggle switch --- */
    .toggle {
        @apply relative inline-block w-10 h-[22px] shrink-0;
    }
    .toggle input {
        @apply opacity-0 w-0 h-0;
    }
    .toggle .slider {
        @apply absolute inset-0 cursor-pointer rounded-full
               bg-border transition-colors duration-200 ease-in-out;
    }
    .toggle .slider::before {
        content: "";
        @apply absolute h-4 w-4 left-[3px] bottom-[3px]
               bg-white rounded-full transition-transform duration-200 ease-in-out;
    }
    .toggle input:checked + .slider {
        @apply bg-primary;
    }
    .toggle input:checked + .slider::before {
        transform: translateX(18px);
    }

    /* --- Range input --- */
    input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        @apply w-full h-1.5 rounded-sm bg-border outline-none
               transition-colors duration-200 ease-in-out;
    }
    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        @apply w-[18px] h-[18px] bg-primary rounded-full
               cursor-pointer shadow-sm;
        border: 2px solid var(--c-bg-card);
        transition: transform 0.15s ease;
    }
    input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.15);
    }
    input[type="range"]::-moz-range-thumb {
        @apply w-[18px] h-[18px] bg-primary rounded-full
               cursor-pointer shadow-sm;
        border: 2px solid var(--c-bg-card);
    }

    /* --- Color input --- */
    input[type="color"] {
        -webkit-appearance: none;
        appearance: none;
        @apply w-9 h-9 p-0.5 cursor-pointer bg-transparent
               rounded-sm;
        border: 2px solid var(--c-border);
    }
    input[type="color"]::-webkit-color-swatch-wrapper {
        padding: 0;
    }
    input[type="color"]::-webkit-color-swatch {
        @apply border-none rounded-xs;
    }

    /* --- Tooltip --- */
    .tooltip {
        @apply relative;
    }
    .tooltip::after {
        content: attr(data-tooltip);
        @apply absolute bottom-[calc(100%+8px)] left-1/2 -translate-x-1/2
               px-3 py-1.5 text-[0.78rem] font-normal leading-[1.4]
               whitespace-nowrap rounded-sm opacity-0 pointer-events-none z-50;
        background: var(--c-text);
        color: var(--c-bg);
        transition: opacity 0.15s ease;
    }
    .tooltip:hover::after {
        @apply opacity-100;
    }
}

/* ===== Vue transition helpers ===== */
.fade-enter-active,
.fade-leave-active {
    transition: opacity 0.25s ease;
}
.fade-enter-from,
.fade-leave-to {
    opacity: 0;
}

.slide-enter-active,
.slide-leave-active {
    transition: all 0.3s ease;
}
.slide-enter-from {
    transform: translateX(-10px);
    opacity: 0;
}
.slide-leave-to {
    transform: translateX(10px);
    opacity: 0;
}

/* ===== KaTeX overrides ===== */
/* These rules sit OUTSIDE any @layer so they get the highest cascade priority,
   preventing Tailwind's preflight / base resets from breaking KaTeX rendering. */

.katex,
.katex-display {
    font-size: 1.05em !important;
    line-height: normal !important;
}

.katex-display {
    margin: 0.5em 0 !important;
    overflow-x: auto;
    overflow-y: hidden;
}

/* Tailwind preflight sets `svg { display: block }` which breaks KaTeX inline SVGs
   (square-root signs, fraction bars, delimiters, etc.). Restore them. */
.katex svg,
.katex-display svg {
    display: inline !important;
    max-width: none !important;
}

.katex img,
.katex-display img {
    display: inline !important;
    max-width: none !important;
}

/* Tailwind preflight `* { margin:0; padding:0; box-sizing:border-box }` strips
   spacing that KaTeX's own CSS relies on for .vlist positioning, superscripts,
   subscripts, fractions, etc. Revert to browser defaults inside KaTeX subtrees.
   Scoped to .katex-html / .katex-mathml to avoid collateral resets on siblings.
   Do NOT use !important here â€” KaTeX's own explicit styles (higher specificity)
   must still win over this blanket revert. */
.katex .katex-html *,
.katex .katex-html *::before,
.katex .katex-html *::after,
.katex .katex-mathml *,
.katex .katex-mathml *::before,
.katex .katex-mathml *::after {
    margin: revert;
    padding: revert;
    box-sizing: revert;
    border: revert;
}

/* ===== Responsive helpers ===== */
@media (max-width: 768px) {
    :root {
        --header-height: 54px;
        --sidebar-width: 100%;
    }
    .hide-mobile {
        display: none !important;
    }
}
@media (min-width: 769px) {
    .hide-desktop {
        display: none !important;
    }
}
